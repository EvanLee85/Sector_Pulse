# 02. é¡¹ç›®æ–‡ä»¶ç»“æ„ï¼ˆå¯¹é½ 00ã€ŠV2.3.1ã€‹ & 01ã€Šæµç¨‹å›¾ v3.3ã€‹ï¼‰ ğŸ§­âœ¨

> ç›®æ ‡ï¼šç›®å½•ã€å‘½åä¸èŒè´£ä¸ç­–ç•¥/æµç¨‹å›¾ä¸€è‡´ï¼›æ‰€æœ‰å…³é”®è°ƒç”¨å¯è½ä½ä¸è¿½æº¯ã€‚  
> çº¦å®šï¼šç±» `PascalCase`ã€å‡½æ•° `snake_case`ï¼›å­˜å‚¨å†™å…¥ç»Ÿä¸€ `save_*`ï¼ŒæŒ‡æ ‡å…¥åº“ç»Ÿä¸€ `upsert_indicators`ï¼›é€šçŸ¥ç»Ÿä¸€ `Notification.send_alert()`ï¼›å‚æ•°ç»Ÿä¸€ `ParameterManager.*`ã€‚

---

## ä¸€ã€ç›®å½•æ ‘ï¼ˆæ€»è§ˆï¼‰ğŸŒ³

```
short_second_strategy v2.3.1/  
â”‚  
â”œâ”€â”€ ğŸ“˜ README.md  
â”œâ”€â”€ ğŸ“¦ requirements.txt  
â”œâ”€â”€ ğŸš€ main.py â€” å¯åŠ¨å…¥å£ï¼š--web / --scheduler / --all  
â”œâ”€â”€ â±ï¸ run_scheduler.py â€” è°ƒåº¦å¯åŠ¨  
â”œâ”€â”€ ğŸŒ run_web.py â€” Web å¯åŠ¨ï¼ˆStreamlitï¼‰  
â”‚  
â”œâ”€â”€ ğŸ“Š data/  
â”‚   â”œâ”€â”€ ğŸ’¾ trading_system.db  
â”‚   â”œâ”€â”€ ğŸ§° cache/  
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ daily_cache.json  
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ indicators_cache.pkl  
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ sector_cache.json  
â”‚   â”‚   â””â”€â”€ ğŸ“„ qvix_percentile_cache.pkl ğŸ†•  
â”‚   â””â”€â”€ ğŸ—ƒï¸ backups/  
â”‚       â”œâ”€â”€ ğŸ§¯ db_backup_YYYYMMDD.db  
â”‚       â””â”€â”€ ğŸ§¯ params_backup_YYYYMMDD.json  
â”‚  
â”œâ”€â”€ âš™ï¸ config/  
â”‚   â”œâ”€â”€ ğŸ§© settings.py â€” logging/database/akshare/scheduler/web/notification 
â”‚   â”œâ”€â”€ ğŸ—ºï¸ data_source_mapping.json â€” ğŸ†• æ•°æ®æºæ˜ å°„é…ç½®æ–‡ä»¶çš„ä½œç”¨ - è¿æ¥æŠ½è±¡æ¥å£å’Œå…·ä½“API
â”‚   â”œâ”€â”€ ğŸ«™ default_params.json â€” é»˜è®¤é˜ˆå€¼ï¼ˆRR/Pwin/EVï¼‰ã€æ®µä½ã€ä»“ä½ä¸Šé™ç­‰  
â”‚   â”œâ”€â”€ ğŸ«™ user_params.json â€” ç”¨æˆ·å‚æ•°é›†ï¼ˆå¯å¤šå¥—ï¼‰  
â”‚   â”œâ”€â”€ ğŸ“ param_schema.json â€” å‚æ•°ç»“æ„/æ ¡éªŒè§„åˆ™  
â”‚   â”œâ”€â”€ ğŸ§¾ param_history.json â€” å‚æ•°ç‰ˆæœ¬/å›æ»š  
â”‚   â”œâ”€â”€ ğŸ—„ï¸ database_schema.sql â€” DB è¡¨ç»“æ„ï¼ˆå«æ¦‚å¿µæ¿å—ç›¸å…³è¡¨ï¼‰  
â”‚   â”œâ”€â”€ ğŸ”” notification.yaml â€” é€šçŸ¥æ¸ é“ï¼ˆé‚®ä»¶/ä¼å¾®/é’‰é’‰â€¦ï¼‰  
â”‚   â””â”€â”€ ğŸ” secrets.env â€” ç§å¯†å‡­æ®  
â”‚  
â”œâ”€â”€ ğŸ›°ï¸ data_service/
â”‚   â”œâ”€â”€ ğŸ§³ __init__.py
â”‚   â”œâ”€â”€ ğŸ“¥ collector.py âœ… â€” é‡‡é›†ï¼šmarket/sector/concept/dragon_tiger/fund_flow/qvix/etf/a50/margin
â”‚   â”‚   â””â”€â”€ # collect_a50_futures() / collect_margin_data() ğŸ†•
â”‚   â”œâ”€â”€ ğŸ’½ storage.py âœ… â€” åˆ†è¡¨å…¥åº“/æŒ‡æ ‡å…¥åº“/äº¤æ˜“è®°å½•/å¤‡ä»½
â”‚   â”‚   â””â”€â”€ # save_a50_futures() / save_margin_data() ğŸ†•
â”‚   â”œâ”€â”€ ğŸ§¹ cleaner.py âœ… â€” æ ‡å‡†åŒ–/å»é‡/äº¤æ˜“æ—¥å†å¯¹é½/å¼‚å¸¸æ ‡è®°ï¼ˆå«è¡Œä¸š&æ¦‚å¿µå£å¾„åˆå¹¶ï¼‰
â”‚   â”œâ”€â”€ ğŸ“ˆ market_data.py â€” è¡Œæƒ…æ•°æ®åŠ å·¥/èšåˆ
â”‚   â”œâ”€â”€ ğŸ’¸ fund_flow.py â€” èµ„é‡‘æµä¸åŒ—å‘èµ„é‡‘å¤„ç†
â”‚   â”œâ”€â”€ ğŸ§± sector_data.py â€” è¡Œä¸šæ¿å—ï¼šå¿«ç…§/æˆåˆ†/å†å²/åˆ†é’Ÿçº§å¤„ç†
â”‚   â”œâ”€â”€ ğŸ§© concept_data.py â€” æ¦‚å¿µæ¿å—ï¼šå¿«ç…§/æˆåˆ†/å†å²/åˆ†é’Ÿçº§å¤„ç†
â”‚   â””â”€â”€ ğŸ“Š indicators.py âœ… â€” æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
â”‚       â””â”€â”€ # calculate_qvix_percentile() / calculate_qvix_daily_change() ğŸ†•
â”‚       â””â”€â”€ # calculate_impact_cost() ğŸ†•
â”‚  
â”œâ”€â”€ ğŸ§  strategy/  
â”‚   â”œâ”€â”€ ğŸ§³ __init__.py  
â”‚   â”œâ”€â”€ ğŸ§­ regime_detector.py âœ… â€” æ®µä½ï¼šè¿›æ”»/æ ‡å‡†/é˜²å®ˆ/ä¼‘çœ 
â”‚   â”‚   â””â”€â”€ # å…­çŠ¶æ€æšä¸¾ï¼šBULL_ACC/STA/NEUT_UP/DOWN/BEAR_REB/DEC ğŸ†•
â”‚   â”‚   â””â”€â”€ # map_six_states_to_four_regimes() ğŸ†•
â”‚   â”‚   â””â”€â”€ # check_qvix_conditions() / check_a50_conditions() / check_margin_conditions() ğŸ†•
â”‚   â”œâ”€â”€ ğŸ§ª sector_analyzer.py âœ… â€” è¡Œä¸šæ¿å—å…­æ­¥éªŒè¯ï¼ˆâ‰¥5 æ­¥é€šè¿‡ï¼‰  
â”‚   â”œâ”€â”€ ğŸ§ª concept_analyzer.py âœ… â€” æ¦‚å¿µæ¿å—å…­æ­¥éªŒè¯ï¼ˆâ‰¥5 æ­¥é€šè¿‡ï¼‰
â”‚   â”œâ”€â”€ ğŸ“Š correlation_matrix.py ğŸ†• â€” æ¿å—å…³è”çŸ©é˜µåˆ†æ
â”‚   â”‚   â””â”€â”€ # analyze_sector_correlation() â€” è¯†åˆ«å…±æŒ¯æ”¾å¤§/è··è··æ¿æ•ˆåº”
â”‚   â”‚   â””â”€â”€ # calculate_logic_chain_strength() â€” é€»è¾‘é“¾å¼ºåº¦è¯„åˆ†(1.0/0.7/0.3)
â”‚   â”œâ”€â”€ ğŸ”„ lifecycle_detector.py ğŸ†• â€” æ¿å—ç”Ÿå‘½å‘¨æœŸåˆ¤å®š
â”‚   â”‚   â””â”€â”€ # identify_stage() â€” èŒèŠ½æœŸ/çˆ†å‘æœŸ/æˆç†ŸæœŸ
â”‚   â”‚   â””â”€â”€ # adjust_buy_signal_weights() â€” åŠ¨æ€è°ƒæ•´å››ç±»ä¹°ç‚¹æƒé‡
â”‚   â”œâ”€â”€ ğŸ”® predictive_signals.py ğŸ†• â€” é¢„æµ‹ä¿¡å·èšåˆ
â”‚   â”‚   â””â”€â”€ # analyze_dragon_tiger_flow() â€” é¾™è™æ¦œèµ„é‡‘è¿ç§»(é¢†å…ˆ1-2æ—¥)
â”‚   â”‚   â””â”€â”€ # detect_etf_abnormal_flow() â€” ETFå¼‚åŠ¨ç”³èµ(0.5-1æ—¥)
â”‚   â”‚   â””â”€â”€ # calculate_option_pcr() â€” æœŸæƒPCRå˜åŒ–(åŒæ­¥ç¡®è®¤)
â”‚   â”‚   â””â”€â”€ # aggregate_signals() â€” ä¿¡å·ç»¼åˆè¯„åˆ†
â”‚   â”œâ”€â”€ ğŸ¯ stock_selector.py âœ… â€” ä¸€çº¿ç¡®è®¤ + äºŒçº¿å››å±‚æ¼æ–—ï¼ˆ1â€“5 åªï¼‰
â”‚   â”‚   â””â”€â”€ # calculate_rs_adjusted() â€” RS_adjusted = RS_priceÃ—W1 + RS_volumeÃ—W2 + RS_fundÃ—W3 ğŸ†•
â”‚   â”œâ”€â”€ ğŸ“¡ signal_generator.py âœ… â€” å››ç±»ä¹°ç‚¹ï¼ˆçªç ´/å›è¸©/è¶‹åŠ¿/ååŒ…ï¼‰  
â”‚   â”œâ”€â”€ ğŸ² ev_calculator.py âœ… â€” è·¯å¾„ä¾èµ– EV + Monte Carloï¼ˆç»Ÿä¸€ä¸‰é—¸é—¨ï¼‰
â”‚   â”‚   â””â”€â”€ # calculate_overnight_gap_distribution() ğŸ†•
â”‚   â”‚   â””â”€â”€ # calculate_intraday_drawdown_path() ğŸ†•
â”‚   â”‚   â””â”€â”€ # calculate_time_decay_impact() ğŸ†•
â”‚   â”‚   â””â”€â”€ # calculate_impact_cost() â€” æµåŠ¨æ€§å†²å‡»æˆæœ¬ ğŸ†•
â”‚   â”œâ”€â”€ ğŸ›¡ï¸ risk_controller.py âœ… â€” SOP çº¢çº¿/ç†”æ–­/ä¼‘çœ 
â”‚   â”‚   â””â”€â”€ # check_three_red_lines() â€” æœˆå›æ’¤/QVIX/æµåŠ¨æ€§ ğŸ†•
â”‚   â”‚   â””â”€â”€ # check_two_degradation_conditions() â€” EV_net/èƒœç‡ ğŸ†•
â”‚   â”‚   â””â”€â”€ # execute_shadow_trading() â€” å½±å­å•æœºåˆ¶ ğŸ†•
â”‚   â”œâ”€â”€ ğŸ“Š portfolio_manager.py âœ… â€” Kelly ä»“ä½/ç›¸å…³æ€§çº¦æŸ/å–å‡ºå‰§æœ¬ï¼ˆå« T+5ï¼‰
â”‚   â”‚   â””â”€â”€ # calculate_time_decay_factor() â€” T+1:100% â†’ T+2:90% â†’ T+3:70% â†’ T+4:50% ğŸ†•
â”‚   â””â”€â”€ âš–ï¸ adaptive_weights.py ğŸ†• â€” å‚æ•°æƒé‡è‡ªé€‚åº”
â”‚       â””â”€â”€ # update_rs_weights() â€” æ ¹æ®Regimeè°ƒæ•´RSæƒé‡
â”‚       â””â”€â”€ # update_buy_signal_weights() â€” æ ¹æ®ç”Ÿå‘½å‘¨æœŸè°ƒæ•´ä¹°ç‚¹æƒé‡
â”‚       â””â”€â”€ # evaluate_parameter_performance() â€” å‚æ•°è¡¨ç°è¯„ä¼°
â”‚  
â”œâ”€â”€ ğŸ–¥ï¸ web_interface/  
â”‚   â”œâ”€â”€ ğŸ§³ __init__.py  
â”‚   â”œâ”€â”€ ğŸ  dashboard.py â€” æ€»è§ˆï¼ˆRegime/å€™é€‰/é£æ§/æŒä»“/ç»©æ•ˆï¼›è¡Œä¸š/æ¦‚å¿µåˆ‡æ¢ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ pages/  
â”‚   â”‚   â”œâ”€â”€ 01_overview.pyï¼ˆ"è¡Œä¸š & æ¦‚å¿µ"è”åŠ¨è§†å›¾ã€æ—¶é—´çª—åˆ‡æ¢ã€æ’è¡Œï¼‰  
â”‚   â”‚   â”œâ”€â”€ 02_stock_selection.py  
â”‚   â”‚   â”œâ”€â”€ 03_signals.py  
â”‚   â”‚   â”œâ”€â”€ 04_risk_monitor.py  
â”‚   â”‚   â”œâ”€â”€ 05_performance.py  
â”‚   â”‚   â”œâ”€â”€ 06_trade_log.py  
â”‚   â”‚   â”œâ”€â”€ 07_param_config.pyï¼ˆå‚æ•°å¯è§†åŒ–/ä¿å­˜ï¼‰  
â”‚   â”‚   â”œâ”€â”€ 08_param_risk.py  
â”‚   â”‚   â”œâ”€â”€ 09_param_strategy.py  
â”‚   â”‚   â”œâ”€â”€ 10_param_quant.py  
â”‚   â”‚   â”œâ”€â”€ 11_param_system.py  
â”‚   â”‚   â””â”€â”€ 12_param_manager.py  
â”‚   â”œâ”€â”€ ğŸ§© components/ â€” charts.py | tables.py | alerts.py | metrics.py | widgets.py  
â”‚   â”‚   â””â”€â”€ ï¼ˆç»„ä»¶ç»Ÿä¸€æ”¯æŒ board_type={'industry','concept'} ä»¥åœ¨ä¸¤å¥—å£å¾„ä¸‹å¤ç”¨ï¼‰
â”‚   â””â”€â”€ ğŸ§° utils/ â€” session_state.py | layout_helper.py | data_formatter.py  
â”‚  
â”œâ”€â”€ ğŸ§° utils/  
â”‚   â”œâ”€â”€ ğŸ§³ __init__.py  
â”‚   â”œâ”€â”€ ğŸ“ logger.py âœ… â€” StrategyLogger / log_trade_action / è½®è½¬  
â”‚   â”œâ”€â”€ ğŸ§­ helpers.py âœ… â€” äº¤æ˜“æ—¥å†/æ—¶é—´çª—/å·¥å…·  
â”‚   â”œâ”€â”€ ğŸ§¯ param_manager.py âœ… â€” ParameterManager.load_active_parameters / backup_parameters / save_parameter_set  
â”‚   â”œâ”€â”€ ğŸ“ˆ performance_tracker.py âœ… â€” ç›˜ä¸­/æ—¥åº¦ç»©æ•ˆåŸ‹ç‚¹ä¸é˜ˆå€¼ç›‘æ§  
â”‚   â”œâ”€â”€ ğŸ”” notification.py âœ… â€” Notification.send_alert(event, level, message, channels)  
â”‚   â””â”€â”€ ğŸ—ƒï¸ database_manager.py âœ… â€” è¿æ¥/WAL/å¤‡ä»½/æ¢å¤/å¥åº·  
â”‚  
â”œâ”€â”€ ğŸ—“ï¸ scheduler/  
â”‚   â”œâ”€â”€ ğŸ§³ __init__.py  
â”‚   â”œâ”€â”€ â° task_scheduler.py âœ… â€” APSchedulerï¼›äº¤æ˜“æ—¥å†åˆ¤æ–­ä¸ä»»åŠ¡ç¼–æ’  
â”‚   â”œâ”€â”€ ğŸŒ… premarket_tasks.py âœ… â€” ç›˜å‰ï¼šé‡‡é›†ï¼ˆsector+concept+a50+marginï¼‰â†’ æ¸…æ´— â†’ åˆ†è¡¨è½åº“ â†’ æŒ‡æ ‡ â†’ upsert  
â”‚   â”œâ”€â”€ ğŸ•˜ intraday_tasks.py âœ… â€” ç›˜ä¸­ï¼šä¿¡å· â†’ EV â†’ é£æ§ â†’ ä»“ä½ â†’ æ‰§è¡Œ â†’ ç»©æ•ˆåŸ‹ç‚¹  
â”‚   â”œâ”€â”€ ğŸŒ† postmarket_tasks.py âœ… â€” ç›˜åï¼šå¯¹è´¦/åˆ†å±‚æ ·æœ¬åº“/å‚æ•°è¯„ä¼°/æŠ¥å‘Š  
â”‚   â”œâ”€â”€ ğŸ“† daily_tasks.py â€” æ—¥å¸¸/é€šç”¨ä»»åŠ¡  
â”‚   â””â”€â”€ ğŸ§º maintenance_tasks.py âœ… â€” éäº¤æ˜“æ—¥ï¼šæ•°æ®ç»´æŠ¤/å¤‡ä»½/æŠ¥å‘Š  
â”‚  
â”œâ”€â”€ ğŸ”¬ analysis/  
â”‚   â”œâ”€â”€ ğŸ§³ __init__.py  
â”‚   â”œâ”€â”€ ğŸ§ª backtest_engine.py âœ…  
â”‚   â”œâ”€â”€ ğŸ“Š performance_analyzer.py âœ…  
â”‚   â”œâ”€â”€ ğŸ” trade_analyzer.py âœ…  
â”‚   â”œâ”€â”€ ğŸ“‰ drawdown_analyzer.py âœ…  
â”‚   â”œâ”€â”€ ğŸ“„ report_generator.py âœ…  
â”‚   â””â”€â”€ ğŸ—‚ï¸ sample_repository.py ğŸ†• â€” åˆ†å±‚æ ·æœ¬åº“ç®¡ç†
â”‚       â””â”€â”€ # save_by_regime() â€” æŒ‰Regimeåˆ†å±‚å­˜å‚¨(Nâ‰¥30/å±‚)
â”‚       â””â”€â”€ # get_regime_samples() â€” è·å–ç‰¹å®šRegimeæ ·æœ¬
â”‚       â””â”€â”€ # calculate_regime_statistics() â€” åˆ†å±‚ç»Ÿè®¡åˆ†æ
â”‚  
â”œâ”€â”€ ğŸ§¾ logs/  
â”‚   â”œâ”€â”€ ğŸ“… daily/ â€” app/trade/data/error_YYYYMMDD.log  
â”‚   â”œâ”€â”€ ğŸ›ï¸ strategy/ â€” signals.log / risk_events.log / param_changes.log  
â”‚   â”œâ”€â”€ ğŸ”” notifications.log  
â”‚   â”œâ”€â”€ ğŸŒ web/ â€” streamlit.log  
â”‚   â””â”€â”€ ğŸ› ï¸ system/ â€” scheduler.log / performance.log  
â”‚  
â”œâ”€â”€ ğŸ“š docs/  
â”‚   â”œâ”€â”€ user_manual.md | api_docs.md | installation_guide.md | database_guide.md | strategy_explanation.md  
â”‚   â””â”€â”€ ğŸ—ºï¸ workflow_diagram.mmd â€” ä¸ 01 æµç¨‹å›¾ v3.3 åŒæ­¥  
â”‚  
â”œâ”€â”€ ğŸ§ª tests/  
â”‚   â”œâ”€â”€ test_data_service.py | test_strategy.py | test_risk_control.py | test_web_interface.py  
â”‚   â”œâ”€â”€ test_database.py | test_utils.py | test_notification.py | test_param_manager.py  
â”‚   â”œâ”€â”€ test_predictive_signals.py ğŸ†•  
â”‚   â”œâ”€â”€ test_lifecycle_detector.py ğŸ†•  
â”‚   â”œâ”€â”€ test_correlation_matrix.py ğŸ†•  
â”‚   â”œâ”€â”€ test_adaptive_weights.py ğŸ†•  
â”‚   â””â”€â”€ ğŸ§­ conftest.py  
â”‚  
â”œâ”€â”€ ğŸ”§ scripts/  
â”‚   â”œâ”€â”€ ğŸš€ start_system.py | â¹ï¸ stop_system.py | ğŸ—„ï¸ init_database.py  
â”‚   â”œâ”€â”€ ğŸ’¾ backup_data.py | ğŸ”„ restore_data.py | ğŸ§¹ cleanup.py  
â”‚   â”œâ”€â”€ ğŸ“Š generate_report.py | ğŸ§ª system_check.py | ğŸ•°ï¸ import_historical_data.py  
â”‚  
â””â”€â”€ ğŸ› ï¸ tools/  
    â”œâ”€â”€ data_importer.py | param_optimizer.py | strategy_tester.py  
    â””â”€â”€ log_analyzer.py | database_tools.py  
```

---

## äºŒã€æ•°æ®æ¥å£æŠ½è±¡å±‚è®¾è®¡ ğŸ”Œ

### è®¾è®¡åŸåˆ™
- **æ¥å£ç¨³å®š**ï¼šæ–‡æ¡£ä¸­çš„å‡½æ•°åä¿æŒä¸å˜ï¼Œé¿å…å› æ•°æ®æºå˜åŒ–åå¤ä¿®æ”¹æ–‡æ¡£
- **å®ç°çµæ´»**ï¼šå…·ä½“akshare APIè°ƒç”¨å¯åœ¨å®ç°æ—¶è°ƒæ•´ï¼Œæ”¯æŒå¤šæ•°æ®æº
- **é…ç½®é©±åŠ¨**ï¼šæ–°å¢æ•°æ®éœ€æ±‚é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†ï¼Œå®ç°çƒ­æ›´æ–°

### æ•°æ®æ¥å£çº¦å®š
- æ‰€æœ‰æ•°æ®è·å–éƒ½é€šè¿‡ç»Ÿä¸€æŠ½è±¡æ¥å£ï¼Œå…·ä½“APIæ˜ å°„åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼š

```python
class DataCollector:
    # === æ ¸å¿ƒç¨³å®šæ¥å£ï¼ˆæ–‡æ¡£ä¸­å›ºå®šï¼Œä¸è½»æ˜“å˜æ›´ï¼‰ ===
    def get_basic_market_data() -> Dict      # åŸºç¡€è¡Œæƒ…æ•°æ®
    def get_sector_data() -> Dict            # æ¿å—æ•°æ®ï¼ˆè¡Œä¸š+æ¦‚å¿µï¼‰
    def get_correlation_data() -> Dict       # ç›¸å…³æ€§æ•°æ®ï¼ˆè®¡ç®—å¾—å‡ºï¼‰
    def get_fund_flow_data() -> Dict         # èµ„é‡‘æµæ•°æ®
    def get_risk_indicator_data() -> Dict    # é£é™©æŒ‡æ ‡æ•°æ®ï¼ˆQVIXã€A50ã€ä¸¤èï¼‰
    def get_dragon_tiger_data() -> Dict      # é¾™è™æ¦œæ•°æ®
    def get_etf_flow_data() -> Dict          # ETFç”³èµæ•°æ®
    
    # === æ‰©å±•æ¥å£ï¼ˆé€šè¿‡é…ç½®æ–‡ä»¶åŠ¨æ€ç®¡ç†ï¼‰ ===
    def get_extended_data(data_type: str) -> Dict  # é€šç”¨æ‰©å±•æ¥å£
    # å…·ä½“æ‰©å±•ç±»å‹åœ¨ data_source_mapping.json çš„ "extensions" èŠ‚ç‚¹ä¸­å®šä¹‰
```

### é…ç½®æ–‡ä»¶è¯´æ˜
- **ğŸ”— data_source_mapping.json**ï¼šAPIæ˜ å°„é…ç½®ï¼Œæ”¯æŒå¤šæ•°æ®æºã€ç¼“å­˜ç­–ç•¥ã€å¤±è´¥é‡è¯•
- **æ‰©å±•ç‚¹é¢„ç•™**ï¼šæ”¯æŒæœªæ¥æ¥å…¥Windã€Choiceç­‰å…¶ä»–æ•°æ®æº
- **ğŸ”§ ä¸»è¦ç»„æˆéƒ¨åˆ†**
    æ ¸å¿ƒæ¥å£æ˜ å°„ - 7ä¸ªç¨³å®šçš„æ•°æ®æ¥å£ï¼Œè¦†ç›–ç­–ç•¥çš„ä¸»è¦æ•°æ®éœ€æ±‚
    æ‰©å±•æ¥å£ - é¢„ç•™æœªæ¥å¯èƒ½éœ€è¦çš„æ•°æ®æºï¼ˆæœŸæƒã€æœŸè´§ã€æƒ…ç»ªç­‰ï¼‰
    å®¹é”™æœºåˆ¶ - é‡è¯•ã€ç¼“å­˜ã€ç†”æ–­å™¨ç­‰
    ç¼“å­˜ç­–ç•¥ - åˆ†å±‚ç¼“å­˜ï¼Œæé«˜æ€§èƒ½
    é™æµæ§åˆ¶ - é¿å…APIè°ƒç”¨è¿‡é¢‘
    æ•°æ®è´¨é‡ - æ•°æ®éªŒè¯å’Œå¼‚å¸¸æ£€æµ‹
    å¤‡ç”¨æ•°æ®æº - Windã€Choiceç­‰å•†ä¸šæ•°æ®æºé¢„ç•™
    ç›‘æ§å‘Šè­¦ - å¥åº·æ£€æŸ¥å’Œæ€§èƒ½ç›‘æ§
    å¼€å‘æ”¯æŒ - æµ‹è¯•æ¨¡å¼ã€Mockæ•°æ®ç­‰
- **âœ… è®¾è®¡äº®ç‚¹**
    å‘å‰å…¼å®¹ - æ ¸å¿ƒæ¥å£ç¨³å®šï¼Œæ‰©å±•é€šè¿‡é…ç½®ç®¡ç†
    ç”Ÿäº§å°±ç»ª - åŒ…å«å®Œæ•´çš„ç›‘æ§ã€å®¹é”™ã€é™æµæœºåˆ¶
    å¯ç»´æŠ¤æ€§ - é…ç½®åŒ–ç®¡ç†ï¼Œé¿å…ç¡¬ç¼–ç 
    æ‰©å±•æ€§ - é¢„ç•™å¤šç§æ‰©å±•ç‚¹ï¼Œæ”¯æŒæœªæ¥éœ€æ±‚

### æ•°æ®éœ€æ±‚å˜æ›´æµç¨‹ï¼ˆå…ç–«æœºåˆ¶ï¼‰
1. **éœ€æ±‚è¯„ä¼°**ï¼šç¡®å®šæ•°æ®æ¥å£åç§°ï¼ˆæŠ½è±¡å±‚é¢ï¼‰
2. **é…ç½®æ›´æ–°**ï¼šåœ¨data_source_mapping.jsonä¸­æ·»åŠ APIæ˜ å°„
3. **å®ç°è¿­ä»£**ï¼šåœ¨å…·ä½“ä»£ç ä¸­å®ç°ï¼Œä¸å½±å“æ–‡æ¡£æ¶æ„
4. **æ–‡æ¡£ç¨³å®š**ï¼šä¸‰ä¸ªæ ¸å¿ƒæ–‡æ¡£ä¿æŒä¸å˜

è¿™æ ·è®¾è®¡ç¡®ä¿äº†æ–‡æ¡£çš„ç¨³å®šæ€§ï¼Œé¿å…å› æ•°æ®æºé¢‘ç¹å˜åŒ–è€Œåå¤ä¿®æ”¹æ ¸å¿ƒæ¶æ„æ–‡æ¡£ã€‚

---

## ä¸‰ã€å…³é”®æ–‡ä»¶è¯´æ˜ ğŸ§·

### 1) å¯åŠ¨æ–‡ä»¶ï¼ˆä¸æµç¨‹å›¾ A/B/W åŒ¹é…ï¼‰ğŸŸ¢
- **ğŸš€ main.py**ï¼šè§£æ `--web | --scheduler | --all`ï¼›`--all` å¹¶å‘ Web + Schedulerï¼›è°ƒåº¦å‰å…ˆ `ParameterManager.load_active_parameters()`ï¼›å…³é”®æ—¥å¿—è½ `logs/system/scheduler.log`ã€‚  
- **â±ï¸ run_scheduler.py**ï¼šåˆå§‹åŒ– APSchedulerï¼›æ³¨å†Œ `premarket / intraday / postmarket / maintenance`ï¼›æŒ‰äº¤æ˜“æ—¥å†åˆ‡åˆ†è·¯å¾„ã€‚  
- **ğŸŒ run_web.py**ï¼šå¯åŠ¨ Streamlitï¼›æ³¨å†Œæ€»è§ˆä¸å‚æ•°é¡µï¼›æä¾›å‚æ•°åŠ è½½/ä¿å­˜å…¥å£ã€‚

### 2) é…ç½®ç®¡ç†ï¼ˆä¸ 00/01 å‚æ•°æ¥æºä¸€è‡´ï¼‰ğŸ§©
- **âš™ï¸ config/settings.py**ï¼šç»Ÿä¸€é”®åŸŸ `logging / database / akshare / scheduler / web / notification / paths`ã€‚  
- **ğŸ«™ å‚æ•°æ–‡ä»¶**ï¼š`default_params.json / user_params.json / param_schema.json / param_history.json`ã€‚  
- **ğŸ”” é€šçŸ¥/å‡­æ®**ï¼š`notification.yaml`ï¼›`secrets.env`ã€‚  
- **ğŸ—„ï¸ æ•°æ®åº“**ï¼š`database_schema.sql` å«æ¦‚å¿µæ¿å—ç›¸å…³è¡¨ï¼ˆsnapshot / constituents / history / history_minï¼‰ã€‚

### 3) ç”¨æˆ·å‚æ•°é‡‡é›†ï¼ˆå¯¹åº”æµç¨‹å›¾ W6â€“W11ï¼‰ğŸ§‘â€ğŸ’»
- `07_param_config.py` åŠåˆ†åŸŸå‚æ•°é¡µå±•ç¤º/ç¼–è¾‘/æ ¡éªŒï¼›  
- `ParameterManager.save_parameter_set()` / `load_user_params()`ï¼›  
- `ParameterManager.backup_parameters()`ï¼ˆå¯åŠ¨/éäº¤æ˜“æ—¥ï¼‰ï¼›  
- ä¿å­˜å³æ ¡éªŒï¼ˆschema + é£é™©é˜ˆå€¼ï¼‰ã€‚

### 4) æ ¸å¿ƒæ¨¡å—èŒè´£ï¼ˆä¸æµç¨‹èŠ‚ç‚¹å¯¹è¡¨ï¼‰ğŸ§©

#### ğŸ›°ï¸ **data_service** 
- `collector.py`ï¼šç›˜å‰é‡‡é›† market / sector / concept / dragon_tiger / fund_flow / qvix / etf / **a50 / margin**
- `cleaner.py`ï¼šnormalize â†’ deduplicate â†’ align_trading_calendarï¼›åˆå¹¶è¡Œä¸š&æ¦‚å¿µå¤šé‡å½’å±
- `storage.py`ï¼š
  - åˆ†è¡¨å…¥åº“ï¼šå« `save_a50_futures()` / `save_margin_data()`
  - æŒ‡æ ‡å…¥åº“ï¼š`upsert_indicators`
  - äº¤æ˜“è®°å½•ï¼š`save_trade_record`
  - å¤‡ä»½ï¼š`backup_database`ï¼ˆå¤±è´¥è§¦å‘ `Notification.send_alert`ï¼‰
- `indicators.py`ï¼š
  - **æ–°å¢**ï¼š`calculate_qvix_percentile()` â€” æ»šåŠ¨è®¡ç®—QVIXåˆ†ä½æ•°
  - **æ–°å¢**ï¼š`calculate_qvix_daily_change()` â€” è®¡ç®—æ—¥åº¦å˜åŒ–ç‡
  - **æ–°å¢**ï¼š`calculate_impact_cost()` â€” æµåŠ¨æ€§å†²å‡»æˆæœ¬

#### ğŸ§  **strategy**
- `regime_detector.py`ï¼š
  - **æ–°å¢å…­çŠ¶æ€æšä¸¾**ï¼šBULL_ACC/STAã€NEUT_UP/DOWNã€BEAR_REB/DEC
  - **æ–°å¢æ˜ å°„å‡½æ•°**ï¼š`map_six_states_to_four_regimes()`
  - **æ–°å¢ç¡¬æ¡ä»¶æ£€æŸ¥**ï¼š`check_qvix_conditions()` / `check_a50_conditions()` / `check_margin_conditions()`
- **æ–°å¢æ–‡ä»¶**ï¼š
  - `correlation_matrix.py`ï¼šæ¿å—å…³è”çŸ©é˜µï¼Œè¯†åˆ«å…±æŒ¯/è··è··æ¿
  - `lifecycle_detector.py`ï¼šæ¿å—ç”Ÿå‘½å‘¨æœŸåˆ¤å®šä¸ä¹°ç‚¹æƒé‡è°ƒæ•´
  - `predictive_signals.py`ï¼šé¢„æµ‹ä¿¡å·èšåˆï¼ˆé¾™è™æ¦œ/ETF/æœŸæƒï¼‰
  - `adaptive_weights.py`ï¼šå‚æ•°æƒé‡è‡ªé€‚åº”æ›´æ–°
- `stock_selector.py`ï¼š
  - **æ–°å¢**ï¼š`calculate_rs_adjusted()` â€” RSåŠ¨æ€æ’åºå…¬å¼
- `ev_calculator.py`ï¼š
  - **æ–°å¢è·¯å¾„ä¾èµ–è¦ç´ **ï¼šéš”å¤œè·³ç©ºåˆ†å¸ƒã€ç›˜ä¸­å›æ’¤è·¯å¾„ã€æ—¶é—´è¡°å‡ã€æµåŠ¨æ€§å†²å‡»
- `risk_controller.py`ï¼š
  - **æ–°å¢SOPæœºåˆ¶**ï¼šä¸‰æ¡çº¢çº¿æ£€æŸ¥ã€ä¸¤æ¡é€€åŒ–åˆ¤å®šã€å½±å­å•æœºåˆ¶
- `portfolio_manager.py`ï¼š
  - **æ–°å¢**ï¼š`calculate_time_decay_factor()` â€” T+1åˆ°T+5å®¹å¿åº¦é€’å‡

#### ğŸ—“ï¸ **scheduler**
- ç›˜å‰ï¼šcollectorï¼ˆsector+concept+**a50+margin**ï¼‰ â†’ cleaner â†’ storage.save_* â†’ indicatorsï¼ˆå«**QVIXåˆ†ä½è®¡ç®—**ï¼‰ â†’ storage.upsert_indicators
- **æ–°å¢9:10**ï¼špredictive_signalsèšåˆ
- ç›˜ä¸­ï¼šsignal â†’ EVï¼ˆ**å«æ‰€æœ‰è·¯å¾„ä¾èµ–è¦ç´ **ï¼‰â†’ é£æ§ï¼ˆ**å«SOPçº¢çº¿**ï¼‰â†’ ä»“ä½ï¼ˆ**å«æ—¶é—´è¡°å‡**ï¼‰â†’ æ‰§è¡Œ â†’ ç»©æ•ˆåŸ‹ç‚¹
- ç›˜åï¼šå¯¹è´¦/**åˆ†å±‚æ ·æœ¬åº“**/å‚æ•°è¯„ä¼°ï¼ˆ**è‡ªé€‚åº”æ›´æ–°**ï¼‰/æŠ¥å‘Š

#### ğŸ”¬ **analysis**
- **æ–°å¢**ï¼š`sample_repository.py` â€” åˆ†å±‚æ ·æœ¬åº“ç®¡ç†ï¼ŒæŒ‰Regimeåˆ†å±‚å­˜å‚¨ï¼ˆNâ‰¥30/å±‚ï¼‰

#### ğŸ§ª **tests**
- **æ–°å¢æµ‹è¯•æ–‡ä»¶**ï¼š
  - `test_predictive_signals.py` â€” é¢„æµ‹ä¿¡å·æµ‹è¯•
  - `test_lifecycle_detector.py` â€” ç”Ÿå‘½å‘¨æœŸæ£€æµ‹æµ‹è¯•
  - `test_correlation_matrix.py` â€” å…³è”çŸ©é˜µæµ‹è¯•
  - `test_adaptive_weights.py` â€” è‡ªé€‚åº”æƒé‡æµ‹è¯•

---

## å››ã€ç›®å½•ç»„ç»‡åŸåˆ™ ğŸ§±
- **ğŸ”¤ å‘½åç»Ÿä¸€**ï¼š`save_* / upsert_indicators / ParameterManager.* / Notification.send_alert()`ï¼›æµç¨‹å›¾å‡ºç°çš„æ–¹æ³•åéœ€åœ¨ä»£ç æˆ–æ–‡æ¡£ä¸­è½ä½æ˜ å°„ã€‚  
- **ğŸ§­ è¾¹ç•Œæ¸…æ™°**ï¼šä»… `storage.py` ç›´æ¥å†™ DBï¼›å¤–éƒ¨æ•°æ®è®¿é—®ç”± `data_service/*` ç»Ÿä¸€è´Ÿè´£ã€‚  
- **ğŸªª å¯è§‚æµ‹æ€§**ï¼šæ—¥å¿—åˆ†å±‚ï¼›ä¸‹å•åå³æ—¶ `save_trade_record + log_trade_action + record_realtime_metrics`ã€‚  
- **ğŸ§° é…ç½®ä¸ç¯å¢ƒ**ï¼šå‡­æ®ä»… `secrets.env`ï¼›é€šé“/æ”¶ä»¶äºº/é˜ˆå€¼åœ¨ `notification.yaml`ã€‚  
- **ğŸ§ª æµ‹è¯•ä¸è´¨é‡**ï¼šé‡‡é›†/æ¸…æ´—/è½åº“/æŒ‡æ ‡/EV/é£æ§/ä»“ä½/æ‰§è¡Œ/é€šçŸ¥/å‚æ•°ç­‰å…³é”®è·¯å¾„å…¨è¦†ç›–ï¼›DB è¿ç§»/å¤‡ä»½/æ¢å¤å…·å¤‡é›†æˆæµ‹è¯•ã€‚

---

## äº”ã€æ¨¡å—é—´è°ƒç”¨å…³ç³»ï¼ˆä¸æµç¨‹å›¾å¯¹è¡¨ï¼‰ğŸ”—
```
main.py
â†’ scheduler/task_scheduler.pyï¼ˆäº¤æ˜“æ—¥å†åˆ¤æ–­ï¼‰  
â†’ premarket_tasks.pyï¼š
  - collectorï¼ˆsector+concept+a50+marginï¼‰ 
  - â†’ cleaner 
  - â†’ storage.save_* 
  - â†’ indicators.calculate_indicators + calculate_qvix_percentile + calculate_qvix_daily_change
  - â†’ storage.upsert_indicators
â†’ 9:10 predictive_signals.pyï¼ˆé¢„æµ‹ä¿¡å·èšåˆï¼‰  
â†’ 9:15 regime_detector.pyï¼ˆå…­çŠ¶æ€â†’å››æ®µä½æ˜ å°„ï¼Œå«QVIX/A50/ä¸¤èæ£€æŸ¥ï¼‰  
â†’ 9:20 sector_analyzer.py & concept_analyzer.py â†’ correlation_matrix.py  
â†’ 9:22 lifecycle_detector.pyï¼ˆæ¿å—ç”Ÿå‘½å‘¨æœŸâ†’ä¹°ç‚¹æƒé‡ï¼‰  
â†’ 9:25 stock_selector.pyï¼ˆå«RS_adjustedåŠ¨æ€æ’åºï¼‰  
â†’ ç›˜ä¸­ intraday_tasks.pyï¼š
  - signal_generatorï¼ˆæƒé‡å·²è°ƒæ•´ï¼‰
  - â†’ ev_calculatorï¼ˆè·¯å¾„ä¾èµ–+å†²å‡»æˆæœ¬ï¼‰
  - â†’ risk_controllerï¼ˆSOPä¸‰æ¡çº¢çº¿ï¼‰
  - â†’ portfolio_managerï¼ˆKelly+æ—¶é—´è¡°å‡ï¼‰
  - â†’ storage.save_trade_record 
  - â†’ performance_tracker
â†’ ç›˜å postmarket_tasks.pyï¼š
  - å¯¹è´¦
  - â†’ sample_repositoryï¼ˆåˆ†å±‚å­˜å‚¨ï¼‰
  - â†’ adaptive_weightsï¼ˆå‚æ•°è‡ªé€‚åº”ï¼‰
  - â†’ analysis/report_generator.py
â†’ éäº¤æ˜“æ—¥ maintenance_tasks.pyï¼šbackup_database â†’ Notification.send_alert(å¤±è´¥) + æŠ¥å‘Š/å½’æ¡£
```

---

## å…­ã€å¯¹é½æ ¸å¯¹æ¸…å•ï¼ˆPR è‡ªæ£€ âœ…ï¼‰ğŸ“‹
- [x] **QVIXåŒé‡åˆ¤æ–­**ï¼šåˆ†ä½æ•°é˜ˆå€¼ + æ—¥åº¦å˜åŒ–ç‡ï¼Œç›¸å…³è®¡ç®—æ–¹æ³•å·²åœ¨ `indicators.py` ä¸­å®šä¹‰
- [x] **å…­çŠ¶æ€â†’å››æ®µä½æ˜ å°„**ï¼š`regime_detector.py` åŒ…å«å®Œæ•´æ˜ å°„é€»è¾‘
- [x] **æ¿å—ç”Ÿå‘½å‘¨æœŸ**ï¼šæ–°å¢ `lifecycle_detector.py` å¤„ç†é˜¶æ®µåˆ¤å®šä¸æƒé‡è°ƒæ•´
- [x] **RSåŠ¨æ€æ’åº**ï¼š`stock_selector.py` åŒ…å« `calculate_rs_adjusted()` æ–¹æ³•
- [x] **SOPåˆ¹è½¦ç³»ç»Ÿ**ï¼š`risk_controller.py` å®ç°ä¸‰æ¡çº¢çº¿ã€ä¸¤æ¡é€€åŒ–ã€å½±å­å•
- [x] **è·¯å¾„ä¾èµ–EVè¦ç´ **ï¼š`ev_calculator.py` åŒ…å«æ‰€æœ‰è®¡ç®—è¦ç´ 
- [x] **æ—¶é—´ä»·å€¼è¡°å‡**ï¼š`portfolio_manager.py` å®ç°T+1åˆ°T+5é€’å‡ç®¡ç†
- [x] **é¢„æµ‹ä¿¡å·æ¨¡å—**ï¼šæ–°å¢ `predictive_signals.py` å¤„ç†å¤šç§é¢„æµ‹ä¿¡å·
- [x] **æ¿å—å…³è”çŸ©é˜µ**ï¼šæ–°å¢ `correlation_matrix.py` è¯†åˆ«æ¿å—å…³ç³»
- [x] **æ ·æœ¬åº“åˆ†å±‚**ï¼šæ–°å¢ `sample_repository.py` æŒ‰Regimeåˆ†å±‚ç®¡ç†
- [x] **å‚æ•°è‡ªé€‚åº”**ï¼šæ–°å¢ `adaptive_weights.py` åŠ¨æ€æ›´æ–°æƒé‡
- [x] **æµåŠ¨æ€§å†²å‡»æˆæœ¬**ï¼šåœ¨ `indicators.py` å’Œ `ev_calculator.py` ä¸­å®ç°
- [x] **A50/ä¸¤èæ•°æ®**ï¼š`collector.py` å’Œ `storage.py` æ”¯æŒç›¸å…³æ•°æ®é‡‡é›†å­˜å‚¨
- [x] **ç‰ˆæœ¬å·å¯¹é½**ï¼šæ–‡æ¡£å·²æ›´æ–°ä¸ºå¯¹é½ v3.3